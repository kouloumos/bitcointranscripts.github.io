<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical href=https://www.kouloumos.com/bitcointranscripts.github.io/scalingbitcoin/tokyo-2018/edgedevplusplus/coin-selection/><title>Coin Selection | ₿itcoin Transcripts</title><link href=https://www.kouloumos.com/bitcointranscripts.github.io/css/fontawesome.min.css rel=stylesheet><link rel=stylesheet href=https://www.kouloumos.com/bitcointranscripts.github.io/css/ace.min.css><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.kouloumos.com/bitcointranscripts.github.io/images/btctranscripts.png"><meta name=twitter:title content="Coin Selection"><meta name=twitter:description content="Coin selection
Karl-Johan Alm (kallewoof)
https://twitter.com/kanzure/status/1047708247333859328
Video: https://www.youtube.com/watch?v=ZMzVIi1lgyw
Introduction I am going to do a short talk on coin selection. Everyone calls me kalle. In Japanese, my name is kalle. Coin selection, what it is, how it works, and interestingly enough- in the latest version of Bitcoin Core released yesterday, they have changed the coin selection algorithm for the first time since a long time. They are now using something with more scientific rigor behind it (branch-and-bound coin selection), which is good news."></head><body><nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow sticky-top" id=navbarMain><div class=container><div><a class=navbar-brand href=/bitcointranscripts.github.io>₿itcoin Transcripts</a></div><div class="collapse navbar-collapse" id=navbarMainCollapse><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/bitcointranscripts.github.io/es>es</a></li><li class=nav-item><a class=nav-link href=/bitcointranscripts.github.io/pt>pt</a></li><li class=nav-item><a class=nav-link href=https://github.com/bitcointranscripts/bitcointranscripts target=_blank><i class='fab fa-github'></i></a></li></ul></div></div></nav><div class=container-fluid><div class=row><div class="docs-sidenav order-0 col-12 col-md-3 col-lg-2 col-xl-2 position-sticky border-right"><nav class="navbar navbar-expand-md navbar-light pl-0"><button class="navbar-toggler navbar-toggler-right collapsed" type=button data-toggle=collapse data-target=#sidenav-left-collapse aria-controls=sidenav-left-collapse aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse align-items-start flex-column" id=sidenav-left-collapse><form class="form-inline my-2 my-lg-0 searchbox"><input class="form-control mr-sm-2 w-100" data-search-input id=search-by type=text placeholder='Search (press "/")'></form><ul class="navbar-nav flex-column pt-3"><li data-nav-id=/bitcointranscripts.github.io/adopting-bitcoin/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/adopting-bitcoin/><h6>Adopting Bitcoin</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/bitcointranscripts.github.io/adopting-bitcoin/2021/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/adopting-bitcoin/2021/><h6>Adopting Bitcoin 2021</h6></a><ul class="list-unstyled ml-2"></ul></li></ul></li><li data-nav-id=/bitcointranscripts.github.io/advancing-bitcoin/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/advancing-bitcoin/><h6>Advancing Bitcoin</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/bitcointranscripts.github.io/advancing-bitcoin/2019/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/advancing-bitcoin/2019/><h6>Advancing Bitcoin 2019</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/advancing-bitcoin/2020/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/advancing-bitcoin/2020/><h6>Advancing Bitcoin 2020</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/advancing-bitcoin/2022/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/advancing-bitcoin/2022/><h6>Advancing Bitcoin 2022</h6></a><ul class="list-unstyled ml-2"></ul></li></ul></li><li data-nav-id=/bitcointranscripts.github.io/andreas-antonopoulos/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/andreas-antonopoulos/><h6>Andreas Antonopoulos</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/austin-bitcoin-developers/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/austin-bitcoin-developers/><h6>Austin Bitcoin Developers</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/baltic-honeybadger/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/baltic-honeybadger/><h6>Baltic Honeybadger</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/bitcointranscripts.github.io/baltic-honeybadger/2018/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/baltic-honeybadger/2018/><h6>Baltic Honeybadger 2018</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/baltic-honeybadger/2019/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/baltic-honeybadger/2019/><h6>Baltic Honeybadger 2019</h6></a><ul class="list-unstyled ml-2"></ul></li></ul></li><li data-nav-id=/bitcointranscripts.github.io/bit-block-boom/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/bit-block-boom/><h6>Bit Block Boom</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/bitcointranscripts.github.io/bit-block-boom/2019/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/bit-block-boom/2019/><h6>Bit Block Boom 2019</h6></a><ul class="list-unstyled ml-2"></ul></li></ul></li><li data-nav-id=/bitcointranscripts.github.io/bitcoin-core-dev-tech/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/bitcoin-core-dev-tech/><h6>Bitcoin Core Dev Tech</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/bitcointranscripts.github.io/bitcoin-core-dev-tech/bitcoin-devcore-2015/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/bitcoin-core-dev-tech/bitcoin-devcore-2015/><h6>Bitcoin Devcore Meetup (2015)</h6></a><ul class="list-unstyled ml-2"></ul></li></ul></li><li data-nav-id=/bitcointranscripts.github.io/bitcoin-design/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/bitcoin-design/><h6>Bitcoin Design</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/bitcoin-magazine/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/bitcoin-magazine/><h6>Bitcoin Magazine</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/bitcoinplusplus/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/bitcoinplusplus/><h6>Bitcoin++</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/bitcointranscripts.github.io/bitcoinplusplus/2022/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/bitcoinplusplus/2022/><h6>Bitcoin++ 2022</h6></a><ul class="list-unstyled ml-2"></ul></li></ul></li><li data-nav-id=/bitcointranscripts.github.io/bitcoinology/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/bitcoinology/><h6>Bitcoinology</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/bitcoinops/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/bitcoinops/><h6>Bitcoinops</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/bitcointranscripts.github.io/bitcoinops/schnorr-taproot-workshop-2019/ class="nav-item my-1"><a class="nav-link p-0" href=/bitcointranscripts.github.io/bitcoinops/schnorr-taproot-workshop-2019/><h6>Schnorr Taproot Workshop 2019</h6></a></li></ul></li><li data-nav-id=/bitcointranscripts.github.io/blockchain-protocol-analysis-security-engineering/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/blockchain-protocol-analysis-security-engineering/><h6>Blockchain Protocol Analysis Security Eng</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/bitcointranscripts.github.io/blockchain-protocol-analysis-security-engineering/2017/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/blockchain-protocol-analysis-security-engineering/2017/><h6>Blockchain Protocol Analysis Security Engineering 2017</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/blockchain-protocol-analysis-security-engineering/2018/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/blockchain-protocol-analysis-security-engineering/2018/><h6>Blockchain Protocol Analysis Security Engineering 2018</h6></a><ul class="list-unstyled ml-2"></ul></li></ul></li><li data-nav-id=/bitcointranscripts.github.io/blockstream-webinars/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/blockstream-webinars/><h6>Blockstream Webinars</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/boltathon/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/boltathon/><h6>Boltathon</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/breaking-bitcoin/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/breaking-bitcoin/><h6>Breaking Bitcoin</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/bitcointranscripts.github.io/breaking-bitcoin/2017/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/breaking-bitcoin/2017/><h6>Breaking Bitcoin 2017</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/breaking-bitcoin/2019/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/breaking-bitcoin/2019/><h6>Breaking Bitcoin 2019</h6></a><ul class="list-unstyled ml-2"></ul></li></ul></li><li data-nav-id=/bitcointranscripts.github.io/building-on-bitcoin/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/building-on-bitcoin/><h6>Building On Bitcoin</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/bitcointranscripts.github.io/building-on-bitcoin/2018/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/building-on-bitcoin/2018/><h6>Building On Bitcoin 2018</h6></a><ul class="list-unstyled ml-2"></ul></li></ul></li><li data-nav-id=/bitcointranscripts.github.io/c-lightning/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/c-lightning/><h6>c-lightning</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/chaincode-labs/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/chaincode-labs/><h6>Chaincode Labs</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/bitcointranscripts.github.io/chaincode-labs/chaincode-podcast/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/chaincode-labs/chaincode-podcast/><h6>Chaincode Podcast</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/chaincode-labs/chaincode-residency/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/chaincode-labs/chaincode-residency/><h6>Chaincode Residency</h6></a><ul class="list-unstyled ml-2"></ul></li></ul></li><li data-nav-id=/bitcointranscripts.github.io/chicago-bitdevs/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/chicago-bitdevs/><h6>Chicago Bitdevs</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/coindesk-consensus-2016/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/coindesk-consensus-2016/><h6>Coindesk Consensus</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/coordination-of-decentralized-finance-workshop/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/coordination-of-decentralized-finance-workshop/><h6>Coordination of Decentralized Finance</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/bitcointranscripts.github.io/coordination-of-decentralized-finance-workshop/2020-stanford/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/coordination-of-decentralized-finance-workshop/2020-stanford/><h6>2020 Stanford</h6></a><ul class="list-unstyled ml-2"></ul></li></ul></li><li data-nav-id=/bitcointranscripts.github.io/cppcon/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/cppcon/><h6>CPPcon</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/bitcointranscripts.github.io/cppcon/2017/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/cppcon/2017/><h6>CPPcon 2017</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/cppcon/2020/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/cppcon/2020/><h6>CPPcon 2020</h6></a><ul class="list-unstyled ml-2"></ul></li></ul></li><li data-nav-id=/bitcointranscripts.github.io/cryptoeconomic-systems/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/cryptoeconomic-systems/><h6>Cryptoeconomic Systems</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/bitcointranscripts.github.io/cryptoeconomic-systems/2019/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/cryptoeconomic-systems/2019/><h6>Cryptoeconomic Systems 2019</h6></a><ul class="list-unstyled ml-2"></ul></li></ul></li><li data-nav-id=/bitcointranscripts.github.io/dallas-bitcoin-symposium/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/dallas-bitcoin-symposium/><h6>Dallas Bitcoin Symposium</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/decentralized-financial-architecture-workshop/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/decentralized-financial-architecture-workshop/><h6>Decentralized Financial Architecture Workshop</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/bitcoin-developers-miners-meeting-2016/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/bitcoin-developers-miners-meeting-2016/><h6>Developers-Miners Meeting</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/greg-maxwell/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/greg-maxwell/><h6>Greg Maxwell</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/grincon/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/grincon/><h6>Grincon</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/bitcointranscripts.github.io/grincon/2019/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/grincon/2019/><h6>Grincon 2019</h6></a><ul class="list-unstyled ml-2"></ul></li></ul></li><li data-nav-id=/bitcointranscripts.github.io/honey-badger-diaries/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/honey-badger-diaries/><h6>Honey Badger Diaries</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/iacr/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/iacr/><h6>IACR Crypto</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/la-bitdevs/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/la-bitdevs/><h6>LA Bitdevs</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/layer2-summit/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/layer2-summit/><h6>Layer2 Summit</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/bitcointranscripts.github.io/layer2-summit/2018/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/layer2-summit/2018/><h6>Layer2 Summit 2018</h6></a><ul class="list-unstyled ml-2"></ul></li></ul></li><li data-nav-id=/bitcointranscripts.github.io/lets-talk-bitcoin-podcast/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/lets-talk-bitcoin-podcast/><h6>Lets Talk Bitcoin Podcast</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/lightning-conference/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/lightning-conference/><h6>Lightning Conference</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/bitcointranscripts.github.io/lightning-conference/2019/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/lightning-conference/2019/><h6>Lightning Conference 2019</h6></a><ul class="list-unstyled ml-2"></ul></li></ul></li><li data-nav-id=/bitcointranscripts.github.io/lightning-hack-day/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/lightning-hack-day/><h6>Lightning Hack Day</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/lightning-specification/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/lightning-specification/><h6>Lightning Specification</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/london-bitcoin-devs/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/london-bitcoin-devs/><h6>London Bitcoin Devs</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/magicalcryptoconference/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/magicalcryptoconference/><h6>Magicalcryptoconference</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/bitcointranscripts.github.io/magicalcryptoconference/2019/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/magicalcryptoconference/2019/><h6>Magicalcryptoconference 2019</h6></a><ul class="list-unstyled ml-2"></ul></li></ul></li><li data-nav-id=/bitcointranscripts.github.io/misc/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/misc/><h6>Misc</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/mit-bitcoin-expo/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/mit-bitcoin-expo/><h6>MIT Bitcoin Expo</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/bitcointranscripts.github.io/mit-bitcoin-expo/mit-bitcoin-expo-2015/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/mit-bitcoin-expo/mit-bitcoin-expo-2015/><h6>Mit Bitcoin Expo 2015</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/mit-bitcoin-expo/mit-bitcoin-expo-2016/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/mit-bitcoin-expo/mit-bitcoin-expo-2016/><h6>Mit Bitcoin Expo 2016</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/mit-bitcoin-expo/mit-bitcoin-expo-2017/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/mit-bitcoin-expo/mit-bitcoin-expo-2017/><h6>Mit Bitcoin Expo 2017</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/mit-bitcoin-expo/mit-bitcoin-expo-2018/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/mit-bitcoin-expo/mit-bitcoin-expo-2018/><h6>Mit Bitcoin Expo 2018</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/mit-bitcoin-expo/mit-bitcoin-expo-2019/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/mit-bitcoin-expo/mit-bitcoin-expo-2019/><h6>Mit Bitcoin Expo 2019</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/mit-bitcoin-expo/mit-bitcoin-expo-2020/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/mit-bitcoin-expo/mit-bitcoin-expo-2020/><h6>Mit Bitcoin Expo 2020</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/mit-bitcoin-expo/mit-bitcoin-expo-2021/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/mit-bitcoin-expo/mit-bitcoin-expo-2021/><h6>Mit Bitcoin Expo 2021</h6></a><ul class="list-unstyled ml-2"></ul></li></ul></li><li data-nav-id=/bitcointranscripts.github.io/munich-meetup/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/munich-meetup/><h6>Munich Meetup</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/noded-podcast/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/noded-podcast/><h6>Noded Podcast</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/realworldcrypto/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/realworldcrypto/><h6>Realworldcrypto</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/bitcointranscripts.github.io/realworldcrypto/2018/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/realworldcrypto/2018/><h6>Realworldcrypto 2018</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/realworldcrypto/2021/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/realworldcrypto/2021/><h6>Realworldcrypto 2021</h6></a><ul class="list-unstyled ml-2"></ul></li></ul></li><li data-nav-id=/bitcointranscripts.github.io/rebooting-web-of-trust/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/rebooting-web-of-trust/><h6>Rebooting Web Of Trust</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/bitcointranscripts.github.io/rebooting-web-of-trust/2019-prague/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/rebooting-web-of-trust/2019-prague/><h6>2019 Prague</h6></a><ul class="list-unstyled ml-2"></ul></li></ul></li><li data-nav-id=/bitcointranscripts.github.io/ruben-somsen/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/ruben-somsen/><h6>Ruben Somsen</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/satoshi-roundtable/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/satoshi-roundtable/><h6>Satoshi Roundtable</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/bitcointranscripts.github.io/satoshi-roundtable/sr-004/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/satoshi-roundtable/sr-004/><h6>Sr 004</h6></a><ul class="list-unstyled ml-2"></ul></li></ul></li><li data-nav-id=/bitcointranscripts.github.io/scalingbitcoin/ class="nav-item my-1 parent haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/scalingbitcoin/><h6>Scaling Bitcoin Conference</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/bitcointranscripts.github.io/scalingbitcoin/hong-kong-2015/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/scalingbitcoin/hong-kong-2015/><h6>Hong Kong (2015)</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/scalingbitcoin/milan-2016/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/scalingbitcoin/milan-2016/><h6>Milan (2016)</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/scalingbitcoin/montreal-2015/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/scalingbitcoin/montreal-2015/><h6>Montreal (2015)</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/scalingbitcoin/stanford-2017/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/scalingbitcoin/stanford-2017/><h6>Stanford (2017)</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/bitcointranscripts.github.io/scalingbitcoin/stanford-2017/edgeplusplus/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/scalingbitcoin/stanford-2017/edgeplusplus/><h6>Edgeplusplus</h6></a><ul class="list-unstyled ml-2"></ul></li></ul></li><li data-nav-id=/bitcointranscripts.github.io/scalingbitcoin/tel-aviv-2019/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/scalingbitcoin/tel-aviv-2019/><h6>Tel Aviv (2019)</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/bitcointranscripts.github.io/scalingbitcoin/tel-aviv-2019/edgedevplusplus/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/scalingbitcoin/tel-aviv-2019/edgedevplusplus/><h6>Edgedevplusplus</h6></a><ul class="list-unstyled ml-2"></ul></li></ul></li><li data-nav-id=/bitcointranscripts.github.io/scalingbitcoin/tokyo-2018/ class="nav-item my-1 parent haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/scalingbitcoin/tokyo-2018/><h6>Tokyo (2018)</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/bitcointranscripts.github.io/scalingbitcoin/tokyo-2018/edgedevplusplus/ class="nav-item my-1 parent haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/scalingbitcoin/tokyo-2018/edgedevplusplus/><h6>Edgedevplusplus</h6></a><ul class="list-unstyled ml-2"></ul></li></ul></li></ul></li><li data-nav-id=/bitcointranscripts.github.io/sf-bitcoin-meetup/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/sf-bitcoin-meetup/><h6>SF Bitcoin Meetup</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/simons-institute/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/simons-institute/><h6>Simons Institute</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/stanford-blockchain-conference/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/stanford-blockchain-conference/><h6>Stanford Blockchain</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/bitcointranscripts.github.io/stanford-blockchain-conference/2019/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/stanford-blockchain-conference/2019/><h6>Stanford Blockchain Conference 2019</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/stanford-blockchain-conference/2020/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/stanford-blockchain-conference/2020/><h6>Stanford Blockchain Conference 2020</h6></a><ul class="list-unstyled ml-2"></ul></li></ul></li><li data-nav-id=/bitcointranscripts.github.io/stephan-livera-podcast/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/stephan-livera-podcast/><h6>Stephan Livera Podcast</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/sydney-bitcoin-meetup/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/sydney-bitcoin-meetup/><h6>Sydney Bitcoin Meetup</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/tabconf/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/tabconf/><h6>TABConf</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/bitcointranscripts.github.io/tabconf/2021/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/tabconf/2021/><h6>TABConf 2021</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/tabconf/2022/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/tabconf/2022/><h6>TABConf 2022</h6></a><ul class="list-unstyled ml-2"></ul></li></ul></li><li data-nav-id=/bitcointranscripts.github.io/texas-bitcoin-conference-2014/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/texas-bitcoin-conference-2014/><h6>Texas Bitcoin Conference</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/tftc-podcast/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/tftc-podcast/><h6>TFTC Podcast</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/verifiable-delay-functions/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/verifiable-delay-functions/><h6>Verifiable Delay Functions</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/bitcointranscripts.github.io/verifiable-delay-functions/vdf-day-2019/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/verifiable-delay-functions/vdf-day-2019/><h6>Vdf Day 2019</h6></a><ul class="list-unstyled ml-2"></ul></li></ul></li><li data-nav-id=/bitcointranscripts.github.io/vr-bitcoin/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/vr-bitcoin/><h6>VR Bitcoin</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/w3-blockchain-workshop-2016/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/w3-blockchain-workshop-2016/><h6>W3 Blockchain Workshop</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/wasabi-research-club/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/wasabi-research-club/><h6>Wasabi Research Club</h6></a><ul class="list-unstyled ml-2"></ul></li><li data-nav-id=/bitcointranscripts.github.io/what-bitcoin-did-podcast/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/bitcointranscripts.github.io/what-bitcoin-did-podcast/><h6>What Bitcoin Did Podcast</h6></a><ul class="list-unstyled ml-2"></ul></li></ul></div></nav></div><div class="docs-toc large order-lg-2 order-md-0 order-xs-1 col-12 col-lg-2 col-xl-2 position-sticky"><div class=docs-toc><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#concept>Concept</a></li><li><a href=#coin-selection-goals>Coin selection goals</a></li><li><a href=#branch-and-bound>Branch and bound</a></li><li><a href=#knapsack-solver>Knapsack solver</a></li><li><a href=#branch-and-bound-1>Branch and bound</a></li><li><a href=#branch-and-bound-backtracking>Branch and bound: Backtracking</a></li><li><a href=#branch-and-bound-recording>Branch and bound: recording</a></li><li><a href=#branch-and-bound-termination>Branch and bound: termination</a></li><li><a href=#references>References</a></li></ul></nav></div></div><div class="main col-12 order-1 col-md-9 col-lg-10 col-xl-8 py-3"><a href=/>Home</a>
&lt; <a href=/bitcointranscripts.github.io/tabconf/>TABConf</a>
&lt; <a href=/bitcointranscripts.github.io/london-bitcoin-devs/>London Bitcoin Devs</a>
&lt; <a href=/bitcointranscripts.github.io/misc/>Misc</a>
&lt; <a href=/bitcointranscripts.github.io/advancing-bitcoin/>Advancing Bitcoin</a>
&lt; <a href=/bitcointranscripts.github.io/iacr/>IACR Crypto</a>
&lt; <a href=/bitcointranscripts.github.io/mit-bitcoin-expo/>MIT Bitcoin Expo</a>
&lt; <a href=/bitcointranscripts.github.io/sf-bitcoin-meetup/>SF Bitcoin Meetup</a>
&lt; <a href=/bitcointranscripts.github.io/adopting-bitcoin/>Adopting Bitcoin</a>
&lt; <a href=/bitcointranscripts.github.io/andreas-antonopoulos/>Andreas Antonopoulos</a>
&lt; <a href=/bitcointranscripts.github.io/austin-bitcoin-developers/>Austin Bitcoin Developers</a>
&lt; <a href=/bitcointranscripts.github.io/baltic-honeybadger/>Baltic Honeybadger</a>
&lt; <a href=/bitcointranscripts.github.io/bit-block-boom/>Bit Block Boom</a>
&lt; <a href=/bitcointranscripts.github.io/bitcoin-core-dev-tech/>Bitcoin Core Dev Tech</a>
&lt; <a href=/bitcointranscripts.github.io/bitcoin-design/>Bitcoin Design</a>
&lt; <a href=/bitcointranscripts.github.io/bitcoin-magazine/>Bitcoin Magazine</a>
&lt; <a href=/bitcointranscripts.github.io/bitcoinplusplus/>Bitcoin++</a>
&lt; <a href=/bitcointranscripts.github.io/bitcoinology/>Bitcoinology</a>
&lt; <a href=/bitcointranscripts.github.io/bitcoinops/>Bitcoinops</a>
&lt; <a href=/bitcointranscripts.github.io/blockchain-protocol-analysis-security-engineering/>Blockchain Protocol Analysis Security Eng</a>
&lt; <a href=/bitcointranscripts.github.io/blockstream-webinars/>Blockstream Webinars</a>
&lt; <a href=/bitcointranscripts.github.io/boltathon/>Boltathon</a>
&lt; <a href=/bitcointranscripts.github.io/breaking-bitcoin/>Breaking Bitcoin</a>
&lt; <a href=/bitcointranscripts.github.io/building-on-bitcoin/>Building On Bitcoin</a>
&lt; <a href=/bitcointranscripts.github.io/c-lightning/>c-lightning</a>
&lt; <a href=/bitcointranscripts.github.io/chaincode-labs/>Chaincode Labs</a>
&lt; <a href=/bitcointranscripts.github.io/chicago-bitdevs/>Chicago Bitdevs</a>
&lt; <a href=/bitcointranscripts.github.io/coindesk-consensus-2016/>Coindesk Consensus</a>
&lt; <a href=/bitcointranscripts.github.io/coordination-of-decentralized-finance-workshop/>Coordination of Decentralized Finance</a>
&lt; <a href=/bitcointranscripts.github.io/cppcon/>CPPcon</a>
&lt; <a href=/bitcointranscripts.github.io/cryptoeconomic-systems/>Cryptoeconomic Systems</a>
&lt; <a href=/bitcointranscripts.github.io/dallas-bitcoin-symposium/>Dallas Bitcoin Symposium</a>
&lt; <a href=/bitcointranscripts.github.io/decentralized-financial-architecture-workshop/>Decentralized Financial Architecture Workshop</a>
&lt; <a href=/bitcointranscripts.github.io/bitcoin-developers-miners-meeting-2016/>Developers-Miners Meeting</a>
&lt; <a href=/bitcointranscripts.github.io/greg-maxwell/>Greg Maxwell</a>
&lt; <a href=/bitcointranscripts.github.io/grincon/>Grincon</a>
&lt; <a href=/bitcointranscripts.github.io/honey-badger-diaries/>Honey Badger Diaries</a>
&lt; <a href=/bitcointranscripts.github.io/la-bitdevs/>LA Bitdevs</a>
&lt; <a href=/bitcointranscripts.github.io/layer2-summit/>Layer2 Summit</a>
&lt; <a href=/bitcointranscripts.github.io/lets-talk-bitcoin-podcast/>Lets Talk Bitcoin Podcast</a>
&lt; <a href=/bitcointranscripts.github.io/lightning-conference/>Lightning Conference</a>
&lt; <a href=/bitcointranscripts.github.io/lightning-hack-day/>Lightning Hack Day</a>
&lt; <a href=/bitcointranscripts.github.io/lightning-specification/>Lightning Specification</a>
&lt; <a href=/bitcointranscripts.github.io/magicalcryptoconference/>Magicalcryptoconference</a>
&lt; <a href=/bitcointranscripts.github.io/munich-meetup/>Munich Meetup</a>
&lt; <a href=/bitcointranscripts.github.io/noded-podcast/>Noded Podcast</a>
&lt; <a href=/bitcointranscripts.github.io/realworldcrypto/>Realworldcrypto</a>
&lt; <a href=/bitcointranscripts.github.io/rebooting-web-of-trust/>Rebooting Web Of Trust</a>
&lt; <a href=/bitcointranscripts.github.io/ruben-somsen/>Ruben Somsen</a>
&lt; <a href=/bitcointranscripts.github.io/satoshi-roundtable/>Satoshi Roundtable</a>
&lt; <a href=/bitcointranscripts.github.io/scalingbitcoin/>Scaling Bitcoin Conference</a>
&lt; <a href=/bitcointranscripts.github.io/scalingbitcoin/montreal-2015/>Montreal (2015)</a>
&lt; <a href=/bitcointranscripts.github.io/scalingbitcoin/hong-kong-2015/>Hong Kong (2015)</a>
&lt; <a href=/bitcointranscripts.github.io/scalingbitcoin/milan-2016/>Milan (2016)</a>
&lt; <a href=/bitcointranscripts.github.io/scalingbitcoin/stanford-2017/>Stanford (2017)</a>
&lt; <a href=/bitcointranscripts.github.io/scalingbitcoin/tokyo-2018/>Tokyo (2018)</a>
&lt; <a href=/bitcointranscripts.github.io/scalingbitcoin/tokyo-2018/edgedevplusplus/>Edgedevplusplus</a>
&lt; <a href=/bitcointranscripts.github.io/scalingbitcoin/tel-aviv-2019/>Tel Aviv (2019)</a>
&lt; <a href=/bitcointranscripts.github.io/simons-institute/>Simons Institute</a>
&lt; <a href=/bitcointranscripts.github.io/stanford-blockchain-conference/>Stanford Blockchain</a>
&lt; <a href=/bitcointranscripts.github.io/stephan-livera-podcast/>Stephan Livera Podcast</a>
&lt; <a href=/bitcointranscripts.github.io/sydney-bitcoin-meetup/>Sydney Bitcoin Meetup</a>
&lt; <a href=/bitcointranscripts.github.io/texas-bitcoin-conference-2014/>Texas Bitcoin Conference</a>
&lt; <a href=/bitcointranscripts.github.io/tftc-podcast/>TFTC Podcast</a>
&lt; <a href=/bitcointranscripts.github.io/verifiable-delay-functions/>Verifiable Delay Functions</a>
&lt; <a href=/bitcointranscripts.github.io/vr-bitcoin/>VR Bitcoin</a>
&lt; <a href=/bitcointranscripts.github.io/w3-blockchain-workshop-2016/>W3 Blockchain Workshop</a>
&lt; <a href=/bitcointranscripts.github.io/wasabi-research-club/>Wasabi Research Club</a>
&lt; <a href=/bitcointranscripts.github.io/what-bitcoin-did-podcast/>What Bitcoin Did Podcast</a>
&lt; Coin Selection<h1>Coin Selection</h1><p><i>Transcript By: Bryan Bishop</i></p><p>Category:
<a href=/categories/conference>Conference</a></p><p>Coin selection</p><p>Karl-Johan Alm (kallewoof)</p><p><a href=https://twitter.com/kanzure/status/1047708247333859328>https://twitter.com/kanzure/status/1047708247333859328</a></p><p>Video: <a href="https://www.youtube.com/watch?v=ZMzVIi1lgyw">https://www.youtube.com/watch?v=ZMzVIi1lgyw</a></p><h1 id=introduction>Introduction</h1><p>I am going to do a short talk on coin selection. Everyone calls me kalle. In Japanese, my name is kalle. Coin selection, what it is, how it works, and interestingly enough- in the latest version of Bitcoin Core released yesterday, they have changed the coin selection algorithm for the first time since a long time. They are now using something with more scientific rigor behind it (branch-and-bound coin selection), which is good news.</p><h1 id=concept>Concept</h1><p>The concept behind coin selection is that&mldr; you receive bitcoin in transactions, you&rsquo;ve heard about this. The bitcoin we hold we refer to them as outpoints, which are (txid, output index). You have the transaction id and then an index inside of that transaction. It&rsquo;s the index in the output list on that transaction. The outpoint is something that we own. Even if we use the same address (which we shouldn&rsquo;t) to receive multiple times, each one will have a different outpoint, even if the transaction is similar to a previous transaction. You never have the same outpoint for two separate UTXOs, even if someone sends you money to the same address in the same transaction multiple times. You still have a distinction between these two outpoints because the first one has a lower index and the other one has a higher index.</p><p>When we talk about &ldquo;balance&rdquo; in the wallet, is that we&rsquo;re talking about the sum of all of our outputs and all the coins in there. It&rsquo;s like change at the cash register. You have to find the right combination of coins in order to spend the certain amount of money. However, in bitcoin, you can create your own coin face values. You have to create a new coin for yourself as the change output. You send the rest to the receiver and also miner fees.</p><h1 id=coin-selection-goals>Coin selection goals</h1><p>Ideally, we want to minimize the number of coins we spend at any one time, for several reasons. Every time we &ldquo;aggregate&rdquo; coins together, we connect the histories of the two outpoints to one owner. We pay fees based on the transaction fee, and more coins means bigger sizes and thus more fees. By associating coins together, you are actually degrading the privacy of the system.</p><p>We&rsquo;re also incentivized to try to find coins so that the input is about the same as the output. If we manage that, then we can skip making a new change output, which means a smaller transaction. This means lower fees.</p><p>The process of running this optimization over coins is called &ldquo;coin selection&rdquo;.</p><h1 id=branch-and-bound>Branch and bound</h1><p>A lot of changes in coin selection were deployed in Bitcoin Core v0.17; it&rsquo;s branch-and-bound or otherwise called Murch&rsquo;s algorithm because Murch is the guy who proposed it and one of the developers who worked on it. The old version was called Knapsack solving using subset sum approximation.</p><p>If someone is sending you money to the same address more than once, and you spend one of those UTXOs partially with 10 other coins, then you have told the world that these coins belong to the same person. There are ways to identify these same patterns. It degrades privacy. You always want to spend these coins together, or not at all. If you have three coins all corresponding to a single pubkey, then you should use &ldquo;grouping&rdquo; and spend all of those coins at the same time.</p><h1 id=knapsack-solver>Knapsack solver</h1><p>The knapsack solver was the old implementation. The idea behind the knapsack solver was bruteforcing the coin selection problem. You randomize the set of coins, which is good for privacy so we always want to do that. Then we try coin selection a bunch of times and we try to see how good the result is based on total fees and size, and then the tries are iterated multiple times. For big wallets, this is time intensive. This is what Bitcoin Core was using up until v0.17.</p><p>In more detail, coins are selected by shuffling the coins, iterating over the coins, and if the coin value is equal to the target, you return the coin immediately. If the coin value is less than the target, you put it in the &ldquo;value&rdquo; list and add its value to the total. Otherwise, if the coin value is less than the smallest previous coin larger than target, then you mark it as &ldquo;smallestHigher&rdquo;. If the sum of the total == target, then return the &ldquo;value&rdquo; list. If the sum is less, and there is a marked coin marked as smallestHigher, then return the marked coin.</p><p>You want to find a coin that is as close to the target as possible, but higher. If it&rsquo;s lower then it doesn&rsquo;t meet the payment requirement, but if it&rsquo;s higher then you can break it into change later.</p><p>The knapsack solver uses subset sum approximation. You keep repeating over and over again, in this case 1000 times. What we do is, and this is very bruteforce&mldr; you go through the coins twice. And include the coins if a random boolean is true, or if this is the second pass and the coin has not been included yet. If the target was reached, then see if the total beats the high score (by being smaller), and keep the solution if so.</p><p>All of this is done about 7 times, with different parameters. It prefers not to use recently confirmed or unconfirmed coins, or coins in a long unconfirmed chain. It will try to prefer coins that are confirmed. Stuff like that. It does these various iterations of the same algorithm.</p><h1 id=branch-and-bound-1>Branch and bound</h1><p>The branch-and-bound coin selection algorithm is a little more sophisticated and more efficient. The idea here is to use effective value per UTXO and use efficient search for exact matches. It uses a binary tree to represent un-selected UTXOs. It does a depth-first search. One of the goals is to minimize a waste metric based on cost - long-term expected cost + excess amount.</p><p>When you&rsquo;re sending coins, you&rsquo;re not only spending coins and getting money back, but in the future you&rsquo;re going to spend the coins that you&rsquo;re spending back to yourself. You want to see what the long-term versus short-term fees are for those coins, which gives you a better prediction about how wasteful it is to spend in these ways. You might be creating UTXOs that are going to be dust, or spending a future coin might cost you money. So you do this depth-first exhaustive search in branch-and-bound and there&rsquo;s a waste metric and we just try to minimize that waste metric. It&rsquo;s very straightforward.</p><p>So there&rsquo;s both long-term and short-term fee rates in this algorithm. The long-term feerate is the minimum expected fee rate in the far future like 1008 blocks in the future. Get the cost of spending a resulting change output. Calculate the fee, the long-term fee, and effective value for all &ldquo;eligible&rdquo; inputs. Discard any inputs with a non-positive effective value. The effective value is just the face value minus the fee. Some of them will cost you money to spend, and are not really worth their face value.</p><p>Backtrack if we cannot reach target with remaining available value, selected value is out of range, or if we are more wasteful than the best solution. Record and backtrack if within range of hte target. Otherwise, iterate (unless we&rsquo;re already backtracking).</p><p>The branch and bound solver is also a bit of a knapsack solver. The previous implementation was more of a random heuristic, and not specifically an optimal knapsack solver.</p><h1 id=branch-and-bound-backtracking>Branch and bound: Backtracking</h1><p>I said it&rsquo;s a binary tree, but really it&rsquo;s a boolean vector that we add true or false to. True means it&rsquo;s enabled, false means it&rsquo;s disabled. This is for UTXOs. So we remove &ldquo;unset&rdquo; (false) entries from the current selection until we encounter a &ldquo;set&rdquo; (true) entry, or until out of entries. If the current selection list is empty, then we stop looping (all branches have been traversed). Unset the last entry in the list, and the nremove corresponding effective value from current_value, and remove corresponding waste from current_waste.</p><h1 id=branch-and-bound-recording>Branch and bound: recording</h1><p>Recording is just add the excess value (value - target) to the waste value. If the resulting waste is less than the best waste, then store the current selection as the best selection.</p><h1 id=branch-and-bound-termination>Branch and bound: termination</h1><p>If we don&rsquo;t have a selection that works at all, if there is no best selection at all, fail, otherwise return the best selection and convert the bools.</p><h1 id=references>References</h1><ul><li><a href=http://murch.one/wp-content/uploads/2016/11/erhardt2016coinselection.pdf>http://murch.one/wp-content/uploads/2016/11/erhardt2016coinselection.pdf</a></li><li><a href=http://diyhpl.us/wiki/transcripts/scalingbitcoin/milan/coin-selection/>http://diyhpl.us/wiki/transcripts/scalingbitcoin/milan/coin-selection/</a></li></ul><div class=row></div></div></div></div><script src=https://www.kouloumos.com/bitcointranscripts.github.io/lib/jquery.min.js></script>
<script src=https://www.kouloumos.com/bitcointranscripts.github.io/lib/popper.min.js></script>
<script src=https://www.kouloumos.com/bitcointranscripts.github.io/js/bootstrap.min.js></script>
<script type=text/javascript src=/bitcointranscripts.github.io/plugins/lunr.min.js></script>
<script type=text/javascript src=/bitcointranscripts.github.io/plugins/auto-complete.js></script>
<link href=/bitcointranscripts.github.io/plugins/auto-complete.css rel=stylesheet><script type=text/javascript>var baseurl="https://www.kouloumos.com/bitcointranscripts.github.io/"</script><script type=text/javascript src=/bitcointranscripts.github.io/plugins/search.js></script>
<script type=text/javascript src=https://www.kouloumos.com/bitcointranscripts.github.io/js/custom.js></script>
<script type=text/javascript src=/bitcointranscripts.github.io/plugins/clipboard.js></script>
<script>new ClipboardJS(".btn")</script></body></html>